<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlphaFlow Analytics | Institutional Backtesting Suite</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="backtesting-page">
    <div class="gradient-bg"></div>
    
    <nav class="navbar">
        <div class="nav-container">
            <a href="alphaflow-dashboard.html" class="logo">
                <div class="logo-icon">α</div>
                AlphaFlow Analytics
            </a>
            
            <div class="nav-links">
                <a href="alphaflow-dashboard.html" class="nav-link">Dashboard</a>
                <a href="alphaflow-dashboard.html" class="nav-link">Live Signals</a>
                <a href="alphaflow-backtesting.html" class="nav-link active">Backtesting</a>
                <div class="nav-dropdown">
                    <a href="#" class="nav-link">API ▾</a>
                    <div class="dropdown-menu">
                        <a href="alphaflow-api-docs.html" class="dropdown-item">Documentation</a>
                        <a href="#" class="dropdown-item">System Status</a>
                    </div>
                </div>
            </div>
            
            <div class="nav-actions">
                <span class="status-badge success">
                    <svg width="6" height="6" viewBox="0 0 6 6" fill="currentColor">
                        <circle cx="3" cy="3" r="3"/>
                    </svg>
                    Connected
                </span>
                <button class="btn btn-primary btn-sm">Export Report</button>
            </div>
            <button class="mobile-menu-btn">☰</button>
        </div>
    </nav>
    
    <div class="container">
        <div class="page-header">
            <h1>Institutional Backtesting Suite</h1>
            <p class="page-subtitle">
                Validate cascade patterns with historical data. Import CryptoSoup CSV exports for comprehensive analysis.
            </p>
        </div>
        
        <div class="dashboard">
            <!-- Left Sidebar -->
            <div class="sidebar">
                <div class="upload-card" id="uploadTrigger">
                    <div class="upload-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                    </div>
                    <div class="upload-text">Upload CryptoSoup Data</div>
                    <div class="upload-subtext">CSV or JSON format</div>
                    <input type="file" id="fileInput" accept=".csv,.json" style="display: none;">
                </div>
                
                <div class="file-list" id="fileList">
                    <div class="file-item">
                        <div class="file-info">
                            <svg class="file-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                            </svg>
                            <div>
                                <div>No files uploaded</div>
                                <div style="font-size: 0.75rem; color: var(--text-tertiary);">Upload CSV to begin</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Panel -->
            <div class="main-panel">
                <!-- Configuration -->
                <div class="config-card">
                    <div class="config-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                        </svg>
                        Strategy Configuration
                    </div>
                    
                    <div class="config-grid">
                        <div class="config-group">
                            <label class="config-label">Starting Capital</label>
                            <input type="number" class="config-input" id="startingCapital" value="10000" min="100" step="1000">
                        </div>
                        
                        <div class="config-group">
                            <label class="config-label">Position Size</label>
                            <input type="number" class="config-input" id="positionSize" value="2.5" min="0.5" max="10" step="0.5">
                            <div style="font-size: 0.75rem; color: var(--text-tertiary);">% of capital</div>
                        </div>
                        
                        <div class="config-group">
                            <label class="config-label">Min Confidence</label>
                            <input type="number" class="config-input" id="minConfidence" value="70" min="50" max="95" step="5">
                            <div style="font-size: 0.75rem; color: var(--text-tertiary);">% signal confidence</div>
                        </div>
                        
                        <div class="config-group">
                            <label class="config-label">Stop Loss</label>
                            <input type="number" class="config-input" id="stopLoss" value="1" min="0.5" max="5" step="0.5">
                            <div style="font-size: 0.75rem; color: var(--text-tertiary);">% per trade</div>
                        </div>
                    </div>
                    
                    <div class="config-grid">
                        <div class="config-group">
                            <label class="config-label">Exchange Model</label>
                            <select class="config-input" id="exchangeModel">
                                <option value="binance">Binance Spot (0.1% fee)</option>
                                <option value="binance_pro">Binance Pro (0.075% fee)</option>
                                <option value="coinbase">Coinbase (0.5% fee)</option>
                                <option value="custom">Custom Fee Model</option>
                            </select>
                        </div>
                        
                        <div class="config-group">
                            <label class="config-label">Slippage Model</label>
                            <select class="config-input" id="slippageModel">
                                <option value="none">No Slippage</option>
                                <option value="low">Low Slippage (0.1%)</option>
                                <option value="medium" selected>Medium Slippage (0.25%)</option>
                                <option value="high">High Slippage (0.5%)</option>
                            </select>
                        </div>
                        
                        <div class="config-group">
                            <label class="config-label">Time Horizon</label>
                            <select class="config-input" id="timeHorizon">
                                <option value="minutes">Minutes (Intraday)</option>
                                <option value="hours" selected>Hours (Swing)</option>
                                <option value="days">Days (Position)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                        <button class="btn btn-primary" id="runBacktest" disabled>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="5 3 19 12 5 21 5 3"/>
                            </svg>
                            Run Backtest
                        </button>
                        <button class="btn btn-secondary" id="resetConfig">
                            Reset to Defaults
                        </button>
                        <button class="btn btn-secondary" id="saveStrategy">
                            Save Strategy
                        </button>
                    </div>
                </div>
                
                <!-- Progress -->
                <div class="progress-container" id="progressContainer" style="display: none;">
                    <div class="progress-label">
                        <span>Processing data...</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
                    </div>
                </div>
                
                <!-- Results -->
                <div class="summary-card" id="resultsCard" style="display: none;">
                    <div class="config-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                        </svg>
                        Backtest Results
                    </div>
                    
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-value positive" id="finalCapital">$10,000</div>
                            <div class="summary-label">Final Capital</div>
                        </div>
                        
                        <div class="summary-item">
                            <div class="summary-value positive" id="totalReturn">+0.0%</div>
                            <div class="summary-label">Total Return</div>
                        </div>
                        
                        <div class="summary-item">
                            <div class="summary-value" id="totalTrades">0</div>
                            <div class="summary-label">Total Trades</div>
                        </div>
                        
                        <div class="summary-item">
                            <div class="summary-value positive" id="winRate">0.0%</div>
                            <div class="summary-label">Win Rate</div>
                        </div>
                    </div>
                    
                    <div class="metrics-grid">
                        <div class="metric-item">
                            <div class="metric-label">Sharpe Ratio</div>
                            <div class="metric-value" id="sharpeRatio">0.00</div>
                        </div>
                        
                        <div class="metric-item">
                            <div class="metric-label">Max Drawdown</div>
                            <div class="metric-value" id="maxDrawdown">0.0%</div>
                        </div>
                        
                        <div class="metric-item">
                            <div class="metric-label">Profit Factor</div>
                            <div class="metric-value" id="profitFactor">0.00</div>
                        </div>
                        
                        <div class="metric-item">
                            <div class="metric-label">Avg Trade</div>
                            <div class="metric-value positive" id="avgTrade">$0.00</div>
                        </div>
                    </div>
                </div>
                
                <!-- Pattern Performance -->
                <div class="config-card" id="patternCard" style="display: none;">
                    <div class="config-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 20V10"/>
                            <path d="M12 20V4"/>
                            <path d="M6 20v-6"/>
                        </svg>
                        Pattern Performance
                    </div>
                    
                    <table class="pattern-table" id="patternTable">
                        <thead>
                            <tr>
                                <th>Pattern</th>
                                <th>Trades</th>
                                <th>Win Rate</th>
                                <th>Avg Return</th>
                                <th>Total P&L</th>
                                <th>Confidence</th>
                            </tr>
                        </thead>
                        <tbody id="patternTableBody">
                            <!-- Filled by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Right Panel -->
            <div class="results-panel">
                <!-- Equity Curve -->
                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-title">Equity Curve</div>
                        <div style="font-size: 0.75rem; color: var(--text-tertiary);">Live Simulation</div>
                    </div>
                    <div style="position: relative; height: 200px; width: 100%;">
                        <canvas id="equityChart"></canvas>
                    </div>
                </div>
                
                <!-- Trade Log -->
                <div class="trade-log">
                    <div class="trade-header">
                        <div class="chart-title">Trade Log</div>
                        <div style="font-size: 0.75rem; color: var(--text-tertiary);">Last 50 trades</div>
                    </div>
                    <div id="tradeLog">
                        <div class="trade-entry">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                                <span style="font-weight: 600;">--</span>
                                <span class="trade-profit">--</span>
                            </div>
                            <div style="font-size: 0.75rem; color: var(--text-tertiary);">No trades yet</div>
                        </div>
                    </div>
                </div>
                
                <!-- Statistics -->
                <div class="config-card">
                    <div class="config-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21.21 15.89A10 10 0 1 1 8 2.83"/>
                            <path d="M22 12A10 10 0 0 0 12 2v10z"/>
                        </svg>
                        Statistics
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-bottom: 0.25rem;">Best Pattern</div>
                            <div style="font-weight: 600;" id="bestPattern">--</div>
                        </div>
                        
                        <div>
                            <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-bottom: 0.25rem;">Worst Pattern</div>
                            <div style="font-weight: 600;" id="worstPattern">--</div>
                        </div>
                        
                        <div>
                            <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-bottom: 0.25rem;">Avg Holding Time</div>
                            <div style="font-weight: 600;" id="avgHoldTime">--</div>
                        </div>
                        
                        <div>
                            <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-bottom: 0.25rem;">Data Quality</div>
                            <div style="font-weight: 600;" id="dataQuality">--</div>
                        </div>
                    </div>
                </div>
                
                <!-- Export Controls -->
                <div class="config-card">
                    <div class="config-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Export Results
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                        <button class="btn btn-secondary" id="exportCSV">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <path d="M16 13H8"/>
                                <path d="M16 17H8"/>
                                <path d="M10 9H8"/>
                            </svg>
                            Export CSV Report
                        </button>
                        
                        <button class="btn btn-secondary" id="exportJSON">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2Zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"/>
                                <path d="M18 14h-8"/>
                                <path d="M15 18h-5"/>
                                <path d="M10 6h8v4h-8z"/>
                            </svg>
                            Export JSON Data
                        </button>
                        
                        <button class="btn btn-primary" id="generateReport">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                                <polyline points="10 9 9 9 8 9"/>
                            </svg>
                            Generate Full Report
                        </button>
                    </div>
                </div>
                
                <!-- Feedback -->
                <div class="config-card">
                    <div class="config-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                        Feedback
                    </div>
                    <!-- Embed Tally form -->
                    <iframe src="https://tally.so/r/YOUR-FORM-ID" width="100%" height="500" style="border: none;"></iframe>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>